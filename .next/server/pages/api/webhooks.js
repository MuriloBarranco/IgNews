"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/webhooks";
exports.ids = ["pages/api/webhooks"];
exports.modules = {

/***/ "faunadb":
/*!**************************!*\
  !*** external "faunadb" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("faunadb");

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "stripe":
/*!*************************!*\
  !*** external "stripe" ***!
  \*************************/
/***/ ((module) => {

module.exports = import("stripe");;

/***/ }),

/***/ "(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fwebhooks&preferredRegion=&absolutePagePath=.%2Fsrc%2Fpages%2Fapi%2Fwebhooks.ts&middlewareConfigBase64=e30%3D!":
/*!****************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fwebhooks&preferredRegion=&absolutePagePath=.%2Fsrc%2Fpages%2Fapi%2Fwebhooks.ts&middlewareConfigBase64=e30%3D! ***!
  \****************************************************************************************************************************************************************************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/pages-api/module.compiled */ \"(api)/./node_modules/next/dist/server/future/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(api)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _src_pages_api_webhooks_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/pages/api/webhooks.ts */ \"(api)/./src/pages/api/webhooks.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_src_pages_api_webhooks_ts__WEBPACK_IMPORTED_MODULE_3__]);\n_src_pages_api_webhooks_ts__WEBPACK_IMPORTED_MODULE_3__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_src_pages_api_webhooks_ts__WEBPACK_IMPORTED_MODULE_3__, \"default\"));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_src_pages_api_webhooks_ts__WEBPACK_IMPORTED_MODULE_3__, \"config\");\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/webhooks\",\n        pathname: \"/api/webhooks\",\n        // The following aren't used in production.\n        bundlePath: \"\",\n        filename: \"\"\n    },\n    userland: _src_pages_api_webhooks_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LXJvdXRlLWxvYWRlci9pbmRleC5qcz9raW5kPVBBR0VTX0FQSSZwYWdlPSUyRmFwaSUyRndlYmhvb2tzJnByZWZlcnJlZFJlZ2lvbj0mYWJzb2x1dGVQYWdlUGF0aD0uJTJGc3JjJTJGcGFnZXMlMkZhcGklMkZ3ZWJob29rcy50cyZtaWRkbGV3YXJlQ29uZmlnQmFzZTY0PWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7QUFBc0c7QUFDdkM7QUFDTDtBQUMxRDtBQUN3RDtBQUN4RDtBQUNBLGlFQUFlLHdFQUFLLENBQUMsdURBQVEsWUFBWSxFQUFDO0FBQzFDO0FBQ08sZUFBZSx3RUFBSyxDQUFDLHVEQUFRO0FBQ3BDO0FBQ08sd0JBQXdCLGdIQUFtQjtBQUNsRDtBQUNBLGNBQWMseUVBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxZQUFZO0FBQ1osQ0FBQzs7QUFFRCxxQyIsInNvdXJjZXMiOlsid2VicGFjazovL2lnbmV3cy8/YTFjMCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQYWdlc0FQSVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLW1vZHVsZXMvcGFnZXMtYXBpL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IGhvaXN0IH0gZnJvbSBcIm5leHQvZGlzdC9idWlsZC90ZW1wbGF0ZXMvaGVscGVyc1wiO1xuLy8gSW1wb3J0IHRoZSB1c2VybGFuZCBjb2RlLlxuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIi4vc3JjL3BhZ2VzL2FwaS93ZWJob29rcy50c1wiO1xuLy8gUmUtZXhwb3J0IHRoZSBoYW5kbGVyIChzaG91bGQgYmUgdGhlIGRlZmF1bHQgZXhwb3J0KS5cbmV4cG9ydCBkZWZhdWx0IGhvaXN0KHVzZXJsYW5kLCBcImRlZmF1bHRcIik7XG4vLyBSZS1leHBvcnQgY29uZmlnLlxuZXhwb3J0IGNvbnN0IGNvbmZpZyA9IGhvaXN0KHVzZXJsYW5kLCBcImNvbmZpZ1wiKTtcbi8vIENyZWF0ZSBhbmQgZXhwb3J0IHRoZSByb3V0ZSBtb2R1bGUgdGhhdCB3aWxsIGJlIGNvbnN1bWVkLlxuZXhwb3J0IGNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IFBhZ2VzQVBJUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLlBBR0VTX0FQSSxcbiAgICAgICAgcGFnZTogXCIvYXBpL3dlYmhvb2tzXCIsXG4gICAgICAgIHBhdGhuYW1lOiBcIi9hcGkvd2ViaG9va3NcIixcbiAgICAgICAgLy8gVGhlIGZvbGxvd2luZyBhcmVuJ3QgdXNlZCBpbiBwcm9kdWN0aW9uLlxuICAgICAgICBidW5kbGVQYXRoOiBcIlwiLFxuICAgICAgICBmaWxlbmFtZTogXCJcIlxuICAgIH0sXG4gICAgdXNlcmxhbmRcbn0pO1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1wYWdlcy1hcGkuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fwebhooks&preferredRegion=&absolutePagePath=.%2Fsrc%2Fpages%2Fapi%2Fwebhooks.ts&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api)/./src/pages/api/_lib/manageSubscription.ts":
/*!**************************************************!*\
  !*** ./src/pages/api/_lib/manageSubscription.ts ***!
  \**************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   saveSubscription: () => (/* binding */ saveSubscription)\n/* harmony export */ });\n/* harmony import */ var faunadb__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! faunadb */ \"faunadb\");\n/* harmony import */ var faunadb__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(faunadb__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _services_fauna__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../services/fauna */ \"(api)/./src/services/fauna.ts\");\n/* harmony import */ var _services_stripe__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../services/stripe */ \"(api)/./src/services/stripe.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_services_stripe__WEBPACK_IMPORTED_MODULE_2__]);\n_services_stripe__WEBPACK_IMPORTED_MODULE_2__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\nasync function saveSubscription(subscriptionId, customerId, createAction = false) {\n    const userRef = await _services_fauna__WEBPACK_IMPORTED_MODULE_1__.fauna.query(faunadb__WEBPACK_IMPORTED_MODULE_0__.query.Select(\"ref\", faunadb__WEBPACK_IMPORTED_MODULE_0__.query.Get(faunadb__WEBPACK_IMPORTED_MODULE_0__.query.Match(faunadb__WEBPACK_IMPORTED_MODULE_0__.query.Index(\"user_by_stripe_customer_id\"), customerId))));\n    const subscription = await _services_stripe__WEBPACK_IMPORTED_MODULE_2__.stripe.subscriptions.retrieve(subscriptionId);\n    const subscriptionData = {\n        id: subscription.id,\n        userId: userRef,\n        status: subscription.status,\n        price_id: subscription.items.data[0].price.id\n    };\n    if (createAction) {\n        await _services_fauna__WEBPACK_IMPORTED_MODULE_1__.fauna.query(faunadb__WEBPACK_IMPORTED_MODULE_0__.query.Create(faunadb__WEBPACK_IMPORTED_MODULE_0__.query.Collection(\"subscriptions\"), {\n            data: subscriptionData\n        }));\n    } else {\n        await _services_fauna__WEBPACK_IMPORTED_MODULE_1__.fauna.query(faunadb__WEBPACK_IMPORTED_MODULE_0__.query.Replace(faunadb__WEBPACK_IMPORTED_MODULE_0__.query.Select(\"ref\", faunadb__WEBPACK_IMPORTED_MODULE_0__.query.Get(faunadb__WEBPACK_IMPORTED_MODULE_0__.query.Match(faunadb__WEBPACK_IMPORTED_MODULE_0__.query.Index(\"subscription_by_id\"), subscriptionId))), {\n            data: subscriptionData\n        }));\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9zcmMvcGFnZXMvYXBpL19saWIvbWFuYWdlU3Vic2NyaXB0aW9uLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQW9DO0FBRVc7QUFDRTtBQUUxQyxlQUFlSSxpQkFDcEJDLGNBQXNCLEVBQ3RCQyxVQUFrQixFQUNsQkMsZUFBd0IsS0FBSztJQUU3QixNQUFNQyxVQUFVLE1BQU1OLGtEQUFLQSxDQUFDRixLQUFLLENBQy9CQywwQ0FBQ0EsQ0FBQ1EsTUFBTSxDQUNOLE9BQ0FSLDBDQUFDQSxDQUFDUyxHQUFHLENBQUNULDBDQUFDQSxDQUFDVSxLQUFLLENBQUNWLDBDQUFDQSxDQUFDVyxLQUFLLENBQUMsK0JBQStCTjtJQUl6RCxNQUFNTyxlQUFlLE1BQU1WLG9EQUFNQSxDQUFDVyxhQUFhLENBQUNDLFFBQVEsQ0FBQ1Y7SUFFekQsTUFBTVcsbUJBQW1CO1FBQ3ZCQyxJQUFJSixhQUFhSSxFQUFFO1FBQ25CQyxRQUFRVjtRQUNSVyxRQUFRTixhQUFhTSxNQUFNO1FBQzNCQyxVQUFVUCxhQUFhUSxLQUFLLENBQUNDLElBQUksQ0FBQyxFQUFFLENBQUNDLEtBQUssQ0FBQ04sRUFBRTtJQUMvQztJQUVBLElBQUlWLGNBQWM7UUFDaEIsTUFBTUwsa0RBQUtBLENBQUNGLEtBQUssQ0FDZkMsMENBQUNBLENBQUN1QixNQUFNLENBQUN2QiwwQ0FBQ0EsQ0FBQ3dCLFVBQVUsQ0FBQyxrQkFBa0I7WUFBRUgsTUFBTU47UUFBaUI7SUFFckUsT0FBTztRQUNMLE1BQU1kLGtEQUFLQSxDQUFDRixLQUFLLENBQ2ZDLDBDQUFDQSxDQUFDeUIsT0FBTyxDQUNQekIsMENBQUNBLENBQUNRLE1BQU0sQ0FDTixPQUNBUiwwQ0FBQ0EsQ0FBQ1MsR0FBRyxDQUFDVCwwQ0FBQ0EsQ0FBQ1UsS0FBSyxDQUFDViwwQ0FBQ0EsQ0FBQ1csS0FBSyxDQUFDLHVCQUF1QlAsbUJBRS9DO1lBQUVpQixNQUFNTjtRQUFpQjtJQUcvQjtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vaWduZXdzLy4vc3JjL3BhZ2VzL2FwaS9fbGliL21hbmFnZVN1YnNjcmlwdGlvbi50cz85MWFlIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHF1ZXJ5IGFzIHEgfSBmcm9tIFwiZmF1bmFkYlwiXG5cbmltcG9ydCB7IGZhdW5hIH0gZnJvbSBcIi4uLy4uLy4uL3NlcnZpY2VzL2ZhdW5hXCJcbmltcG9ydCB7IHN0cmlwZSB9IGZyb20gXCIuLi8uLi8uLi9zZXJ2aWNlcy9zdHJpcGVcIlxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2F2ZVN1YnNjcmlwdGlvbihcbiAgc3Vic2NyaXB0aW9uSWQ6IHN0cmluZyxcbiAgY3VzdG9tZXJJZDogc3RyaW5nLFxuICBjcmVhdGVBY3Rpb246IGJvb2xlYW4gPSBmYWxzZVxuKSB7XG4gIGNvbnN0IHVzZXJSZWYgPSBhd2FpdCBmYXVuYS5xdWVyeShcbiAgICBxLlNlbGVjdChcbiAgICAgIFwicmVmXCIsXG4gICAgICBxLkdldChxLk1hdGNoKHEuSW5kZXgoXCJ1c2VyX2J5X3N0cmlwZV9jdXN0b21lcl9pZFwiKSwgY3VzdG9tZXJJZCkpXG4gICAgKVxuICApXG5cbiAgY29uc3Qgc3Vic2NyaXB0aW9uID0gYXdhaXQgc3RyaXBlLnN1YnNjcmlwdGlvbnMucmV0cmlldmUoc3Vic2NyaXB0aW9uSWQpXG5cbiAgY29uc3Qgc3Vic2NyaXB0aW9uRGF0YSA9IHtcbiAgICBpZDogc3Vic2NyaXB0aW9uLmlkLFxuICAgIHVzZXJJZDogdXNlclJlZixcbiAgICBzdGF0dXM6IHN1YnNjcmlwdGlvbi5zdGF0dXMsXG4gICAgcHJpY2VfaWQ6IHN1YnNjcmlwdGlvbi5pdGVtcy5kYXRhWzBdLnByaWNlLmlkLFxuICB9XG5cbiAgaWYgKGNyZWF0ZUFjdGlvbikge1xuICAgIGF3YWl0IGZhdW5hLnF1ZXJ5KFxuICAgICAgcS5DcmVhdGUocS5Db2xsZWN0aW9uKFwic3Vic2NyaXB0aW9uc1wiKSwgeyBkYXRhOiBzdWJzY3JpcHRpb25EYXRhIH0pXG4gICAgKVxuICB9IGVsc2Uge1xuICAgIGF3YWl0IGZhdW5hLnF1ZXJ5KFxuICAgICAgcS5SZXBsYWNlKFxuICAgICAgICBxLlNlbGVjdChcbiAgICAgICAgICBcInJlZlwiLFxuICAgICAgICAgIHEuR2V0KHEuTWF0Y2gocS5JbmRleChcInN1YnNjcmlwdGlvbl9ieV9pZFwiKSwgc3Vic2NyaXB0aW9uSWQpKVxuICAgICAgICApLFxuICAgICAgICB7IGRhdGE6IHN1YnNjcmlwdGlvbkRhdGEgfVxuICAgICAgKVxuICAgIClcbiAgfVxufVxuIl0sIm5hbWVzIjpbInF1ZXJ5IiwicSIsImZhdW5hIiwic3RyaXBlIiwic2F2ZVN1YnNjcmlwdGlvbiIsInN1YnNjcmlwdGlvbklkIiwiY3VzdG9tZXJJZCIsImNyZWF0ZUFjdGlvbiIsInVzZXJSZWYiLCJTZWxlY3QiLCJHZXQiLCJNYXRjaCIsIkluZGV4Iiwic3Vic2NyaXB0aW9uIiwic3Vic2NyaXB0aW9ucyIsInJldHJpZXZlIiwic3Vic2NyaXB0aW9uRGF0YSIsImlkIiwidXNlcklkIiwic3RhdHVzIiwicHJpY2VfaWQiLCJpdGVtcyIsImRhdGEiLCJwcmljZSIsIkNyZWF0ZSIsIkNvbGxlY3Rpb24iLCJSZXBsYWNlIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./src/pages/api/_lib/manageSubscription.ts\n");

/***/ }),

/***/ "(api)/./src/pages/api/webhooks.ts":
/*!***********************************!*\
  !*** ./src/pages/api/webhooks.ts ***!
  \***********************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var _services_stripe__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../services/stripe */ \"(api)/./src/services/stripe.ts\");\n/* harmony import */ var _lib_manageSubscription__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./_lib/manageSubscription */ \"(api)/./src/pages/api/_lib/manageSubscription.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_services_stripe__WEBPACK_IMPORTED_MODULE_0__, _lib_manageSubscription__WEBPACK_IMPORTED_MODULE_1__]);\n([_services_stripe__WEBPACK_IMPORTED_MODULE_0__, _lib_manageSubscription__WEBPACK_IMPORTED_MODULE_1__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\nasync function buffer(readable) {\n    const chunks = [];\n    for await (const chunk of readable){\n        chunks.push(typeof chunk === \"string\" ? Buffer.from(chunk) : chunk);\n    }\n    return Buffer.concat(chunks);\n}\nconst config = {\n    api: {\n        bodyParser: false\n    }\n};\nconst relevantEvents = new Set([\n    \"checkout.session.completed\",\n    \"customer.subscription.updated\",\n    \"customer.subscription.deleted\"\n]);\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (async (req, res)=>{\n    if (req.method === \"POST\") {\n        const buf = await buffer(req);\n        const secret = req.headers[\"stripe-signature\"];\n        let event;\n        try {\n            event = _services_stripe__WEBPACK_IMPORTED_MODULE_0__.stripe.webhooks.constructEvent(buf, secret, process.env.STRIP_WEBHOOK_SECRET);\n        } catch (err) {\n            return res.status(400).send(`Webhook error: ${err.message}`);\n        }\n        const { type } = event;\n        if (relevantEvents.has(type)) {\n            try {\n                switch(type){\n                    case \"customer.subscription.created\":\n                    case \"customer.subscription.updated\":\n                    case \"customer.subscription.deleted\":\n                        const subscription = event.data.object;\n                        await (0,_lib_manageSubscription__WEBPACK_IMPORTED_MODULE_1__.saveSubscription)(subscription.id, subscription.customer.toString());\n                        await (0,_lib_manageSubscription__WEBPACK_IMPORTED_MODULE_1__.saveSubscription)(subscription.id, subscription.customer.toString(), type === \"customer.subscription.created\");\n                        break;\n                    case \"checkout.session.completed\":\n                        const checkoutSession = event.data.object;\n                        await (0,_lib_manageSubscription__WEBPACK_IMPORTED_MODULE_1__.saveSubscription)(checkoutSession.subscription.toString(), checkoutSession.customer.toString(), true);\n                        break;\n                    default:\n                        throw new Error(\"Unhandled event.\");\n                }\n            } catch (err) {\n                return res.json({\n                    error: \"Webhook handler failed.\"\n                });\n            }\n        }\n        res.json({\n            ok: true\n        });\n    } else {\n        // Se nao for uma requisicao post\n        res.setHeader(\"Allow\", \"POST\");\n        // Devolver um erro com codigo 405\n        res.status(405).end(\"Method not allowed\");\n    }\n});\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9zcmMvcGFnZXMvYXBpL3dlYmhvb2tzLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFHOEM7QUFDYztBQUU1RCxlQUFlRSxPQUFPQyxRQUFrQjtJQUN0QyxNQUFNQyxTQUFTLEVBQUU7SUFFakIsV0FBVyxNQUFNQyxTQUFTRixTQUFVO1FBQ2xDQyxPQUFPRSxJQUFJLENBQUMsT0FBT0QsVUFBVSxXQUFXRSxPQUFPQyxJQUFJLENBQUNILFNBQVNBO0lBQy9EO0lBRUEsT0FBT0UsT0FBT0UsTUFBTSxDQUFDTDtBQUN2QjtBQUVPLE1BQU1NLFNBQVM7SUFDcEJDLEtBQUs7UUFDSEMsWUFBWTtJQUNkO0FBQ0YsRUFBQztBQUVELE1BQU1DLGlCQUFpQixJQUFJQyxJQUFJO0lBQzdCO0lBQ0E7SUFDQTtDQUNEO0FBRUQsaUVBQWUsT0FBT0MsS0FBcUJDO0lBQ3pDLElBQUlELElBQUlFLE1BQU0sS0FBSyxRQUFRO1FBQ3pCLE1BQU1DLE1BQU0sTUFBTWhCLE9BQU9hO1FBQ3pCLE1BQU1JLFNBQVNKLElBQUlLLE9BQU8sQ0FBQyxtQkFBbUI7UUFFOUMsSUFBSUM7UUFFSixJQUFJO1lBQ0ZBLFFBQVFyQixvREFBTUEsQ0FBQ3NCLFFBQVEsQ0FBQ0MsY0FBYyxDQUNwQ0wsS0FDQUMsUUFDQUssUUFBUUMsR0FBRyxDQUFDQyxvQkFBb0I7UUFFcEMsRUFBRSxPQUFPQyxLQUFLO1lBQ1osT0FBT1gsSUFBSVksTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQyxDQUFDLGVBQWUsRUFBRUYsSUFBSUcsT0FBTyxDQUFDLENBQUM7UUFDN0Q7UUFFQSxNQUFNLEVBQUVDLElBQUksRUFBRSxHQUFHVjtRQUVqQixJQUFJUixlQUFlbUIsR0FBRyxDQUFDRCxPQUFPO1lBQzVCLElBQUk7Z0JBQ0YsT0FBUUE7b0JBQ04sS0FBSztvQkFDTCxLQUFLO29CQUNMLEtBQUs7d0JBQ0gsTUFBTUUsZUFBZVosTUFBTWEsSUFBSSxDQUFDQyxNQUFNO3dCQUV0QyxNQUFNbEMseUVBQWdCQSxDQUNwQmdDLGFBQWFHLEVBQUUsRUFDZkgsYUFBYUksUUFBUSxDQUFDQyxRQUFRO3dCQUdoQyxNQUFNckMseUVBQWdCQSxDQUNwQmdDLGFBQWFHLEVBQUUsRUFDZkgsYUFBYUksUUFBUSxDQUFDQyxRQUFRLElBQzlCUCxTQUFTO3dCQUdYO29CQUVGLEtBQUs7d0JBQ0gsTUFBTVEsa0JBQWtCbEIsTUFBTWEsSUFBSSxDQUFDQyxNQUFNO3dCQUV6QyxNQUFNbEMseUVBQWdCQSxDQUNwQnNDLGdCQUFnQk4sWUFBWSxDQUFDSyxRQUFRLElBQ3JDQyxnQkFBZ0JGLFFBQVEsQ0FBQ0MsUUFBUSxJQUNqQzt3QkFHRjtvQkFDRjt3QkFDRSxNQUFNLElBQUlFLE1BQU07Z0JBQ3BCO1lBQ0YsRUFBRSxPQUFPYixLQUFLO2dCQUNaLE9BQU9YLElBQUl5QixJQUFJLENBQUM7b0JBQUVDLE9BQU87Z0JBQTBCO1lBQ3JEO1FBQ0Y7UUFFQTFCLElBQUl5QixJQUFJLENBQUM7WUFBRUUsSUFBSTtRQUFLO0lBQ3RCLE9BQU87UUFDTCxpQ0FBaUM7UUFDakMzQixJQUFJNEIsU0FBUyxDQUFDLFNBQVM7UUFDdkIsa0NBQWtDO1FBQ2xDNUIsSUFBSVksTUFBTSxDQUFDLEtBQUtpQixHQUFHLENBQUM7SUFDdEI7QUFDRixHQUFDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vaWduZXdzLy4vc3JjL3BhZ2VzL2FwaS93ZWJob29rcy50cz9kM2E0Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5leHRBcGlSZXF1ZXN0LCBOZXh0QXBpUmVzcG9uc2UgfSBmcm9tIFwibmV4dFwiXG5pbXBvcnQgeyBSZWFkYWJsZSB9IGZyb20gXCJzdHJlYW1cIlxuaW1wb3J0IFN0cmlwZSBmcm9tIFwic3RyaXBlXCJcbmltcG9ydCB7IHN0cmlwZSB9IGZyb20gXCIuLi8uLi9zZXJ2aWNlcy9zdHJpcGVcIlxuaW1wb3J0IHsgc2F2ZVN1YnNjcmlwdGlvbiB9IGZyb20gXCIuL19saWIvbWFuYWdlU3Vic2NyaXB0aW9uXCJcblxuYXN5bmMgZnVuY3Rpb24gYnVmZmVyKHJlYWRhYmxlOiBSZWFkYWJsZSkge1xuICBjb25zdCBjaHVua3MgPSBbXVxuXG4gIGZvciBhd2FpdCAoY29uc3QgY2h1bmsgb2YgcmVhZGFibGUpIHtcbiAgICBjaHVua3MucHVzaCh0eXBlb2YgY2h1bmsgPT09IFwic3RyaW5nXCIgPyBCdWZmZXIuZnJvbShjaHVuaykgOiBjaHVuaylcbiAgfVxuXG4gIHJldHVybiBCdWZmZXIuY29uY2F0KGNodW5rcylcbn1cblxuZXhwb3J0IGNvbnN0IGNvbmZpZyA9IHtcbiAgYXBpOiB7XG4gICAgYm9keVBhcnNlcjogZmFsc2UsXG4gIH0sXG59XG5cbmNvbnN0IHJlbGV2YW50RXZlbnRzID0gbmV3IFNldChbXG4gIFwiY2hlY2tvdXQuc2Vzc2lvbi5jb21wbGV0ZWRcIixcbiAgXCJjdXN0b21lci5zdWJzY3JpcHRpb24udXBkYXRlZFwiLFxuICBcImN1c3RvbWVyLnN1YnNjcmlwdGlvbi5kZWxldGVkXCIsXG5dKVxuXG5leHBvcnQgZGVmYXVsdCBhc3luYyAocmVxOiBOZXh0QXBpUmVxdWVzdCwgcmVzOiBOZXh0QXBpUmVzcG9uc2UpID0+IHtcbiAgaWYgKHJlcS5tZXRob2QgPT09IFwiUE9TVFwiKSB7XG4gICAgY29uc3QgYnVmID0gYXdhaXQgYnVmZmVyKHJlcSlcbiAgICBjb25zdCBzZWNyZXQgPSByZXEuaGVhZGVyc1tcInN0cmlwZS1zaWduYXR1cmVcIl1cblxuICAgIGxldCBldmVudDogU3RyaXBlLkV2ZW50XG5cbiAgICB0cnkge1xuICAgICAgZXZlbnQgPSBzdHJpcGUud2ViaG9va3MuY29uc3RydWN0RXZlbnQoXG4gICAgICAgIGJ1ZixcbiAgICAgICAgc2VjcmV0LFxuICAgICAgICBwcm9jZXNzLmVudi5TVFJJUF9XRUJIT09LX1NFQ1JFVFxuICAgICAgKVxuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5zZW5kKGBXZWJob29rIGVycm9yOiAke2Vyci5tZXNzYWdlfWApXG4gICAgfVxuXG4gICAgY29uc3QgeyB0eXBlIH0gPSBldmVudFxuXG4gICAgaWYgKHJlbGV2YW50RXZlbnRzLmhhcyh0eXBlKSkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgc3dpdGNoICh0eXBlKSB7XG4gICAgICAgICAgY2FzZSBcImN1c3RvbWVyLnN1YnNjcmlwdGlvbi5jcmVhdGVkXCI6XG4gICAgICAgICAgY2FzZSBcImN1c3RvbWVyLnN1YnNjcmlwdGlvbi51cGRhdGVkXCI6XG4gICAgICAgICAgY2FzZSBcImN1c3RvbWVyLnN1YnNjcmlwdGlvbi5kZWxldGVkXCI6XG4gICAgICAgICAgICBjb25zdCBzdWJzY3JpcHRpb24gPSBldmVudC5kYXRhLm9iamVjdCBhcyBTdHJpcGUuU3Vic2NyaXB0aW9uXG5cbiAgICAgICAgICAgIGF3YWl0IHNhdmVTdWJzY3JpcHRpb24oXG4gICAgICAgICAgICAgIHN1YnNjcmlwdGlvbi5pZCxcbiAgICAgICAgICAgICAgc3Vic2NyaXB0aW9uLmN1c3RvbWVyLnRvU3RyaW5nKClcbiAgICAgICAgICAgIClcblxuICAgICAgICAgICAgYXdhaXQgc2F2ZVN1YnNjcmlwdGlvbihcbiAgICAgICAgICAgICAgc3Vic2NyaXB0aW9uLmlkLFxuICAgICAgICAgICAgICBzdWJzY3JpcHRpb24uY3VzdG9tZXIudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgdHlwZSA9PT0gXCJjdXN0b21lci5zdWJzY3JpcHRpb24uY3JlYXRlZFwiXG4gICAgICAgICAgICApXG5cbiAgICAgICAgICAgIGJyZWFrXG5cbiAgICAgICAgICBjYXNlIFwiY2hlY2tvdXQuc2Vzc2lvbi5jb21wbGV0ZWRcIjpcbiAgICAgICAgICAgIGNvbnN0IGNoZWNrb3V0U2Vzc2lvbiA9IGV2ZW50LmRhdGEub2JqZWN0IGFzIFN0cmlwZS5DaGVja291dC5TZXNzaW9uXG5cbiAgICAgICAgICAgIGF3YWl0IHNhdmVTdWJzY3JpcHRpb24oXG4gICAgICAgICAgICAgIGNoZWNrb3V0U2Vzc2lvbi5zdWJzY3JpcHRpb24udG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgY2hlY2tvdXRTZXNzaW9uLmN1c3RvbWVyLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgIHRydWVcbiAgICAgICAgICAgIClcblxuICAgICAgICAgICAgYnJlYWtcbiAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVW5oYW5kbGVkIGV2ZW50LlwiKVxuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKHsgZXJyb3I6IFwiV2ViaG9vayBoYW5kbGVyIGZhaWxlZC5cIiB9KVxuICAgICAgfVxuICAgIH1cblxuICAgIHJlcy5qc29uKHsgb2s6IHRydWUgfSlcbiAgfSBlbHNlIHtcbiAgICAvLyBTZSBuYW8gZm9yIHVtYSByZXF1aXNpY2FvIHBvc3RcbiAgICByZXMuc2V0SGVhZGVyKFwiQWxsb3dcIiwgXCJQT1NUXCIpXG4gICAgLy8gRGV2b2x2ZXIgdW0gZXJybyBjb20gY29kaWdvIDQwNVxuICAgIHJlcy5zdGF0dXMoNDA1KS5lbmQoXCJNZXRob2Qgbm90IGFsbG93ZWRcIilcbiAgfVxufVxuIl0sIm5hbWVzIjpbInN0cmlwZSIsInNhdmVTdWJzY3JpcHRpb24iLCJidWZmZXIiLCJyZWFkYWJsZSIsImNodW5rcyIsImNodW5rIiwicHVzaCIsIkJ1ZmZlciIsImZyb20iLCJjb25jYXQiLCJjb25maWciLCJhcGkiLCJib2R5UGFyc2VyIiwicmVsZXZhbnRFdmVudHMiLCJTZXQiLCJyZXEiLCJyZXMiLCJtZXRob2QiLCJidWYiLCJzZWNyZXQiLCJoZWFkZXJzIiwiZXZlbnQiLCJ3ZWJob29rcyIsImNvbnN0cnVjdEV2ZW50IiwicHJvY2VzcyIsImVudiIsIlNUUklQX1dFQkhPT0tfU0VDUkVUIiwiZXJyIiwic3RhdHVzIiwic2VuZCIsIm1lc3NhZ2UiLCJ0eXBlIiwiaGFzIiwic3Vic2NyaXB0aW9uIiwiZGF0YSIsIm9iamVjdCIsImlkIiwiY3VzdG9tZXIiLCJ0b1N0cmluZyIsImNoZWNrb3V0U2Vzc2lvbiIsIkVycm9yIiwianNvbiIsImVycm9yIiwib2siLCJzZXRIZWFkZXIiLCJlbmQiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./src/pages/api/webhooks.ts\n");

/***/ }),

/***/ "(api)/./src/services/fauna.ts":
/*!*******************************!*\
  !*** ./src/services/fauna.ts ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   fauna: () => (/* binding */ fauna)\n/* harmony export */ });\n/* harmony import */ var faunadb__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! faunadb */ \"faunadb\");\n/* harmony import */ var faunadb__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(faunadb__WEBPACK_IMPORTED_MODULE_0__);\n\nconst fauna = new faunadb__WEBPACK_IMPORTED_MODULE_0__.Client({\n    secret: process.env.FAUNADB_KEY\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9zcmMvc2VydmljZXMvZmF1bmEudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQStCO0FBRXhCLE1BQU1DLFFBQVEsSUFBSUQsMkNBQU1BLENBQUM7SUFDNUJFLFFBQVFDLFFBQVFDLEdBQUcsQ0FBQ0MsV0FBVztBQUNuQyxHQUFFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vaWduZXdzLy4vc3JjL3NlcnZpY2VzL2ZhdW5hLnRzPzMyM2EiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ2xpZW50fSBmcm9tICdmYXVuYWRiJ1xuXG5leHBvcnQgY29uc3QgZmF1bmEgPSBuZXcgQ2xpZW50KHtcbiAgICBzZWNyZXQ6IHByb2Nlc3MuZW52LkZBVU5BREJfS0VZXG59KSJdLCJuYW1lcyI6WyJDbGllbnQiLCJmYXVuYSIsInNlY3JldCIsInByb2Nlc3MiLCJlbnYiLCJGQVVOQURCX0tFWSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./src/services/fauna.ts\n");

/***/ }),

/***/ "(api)/./src/services/stripe.ts":
/*!********************************!*\
  !*** ./src/services/stripe.ts ***!
  \********************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   stripe: () => (/* binding */ stripe)\n/* harmony export */ });\n/* harmony import */ var stripe__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! stripe */ \"stripe\");\n/* harmony import */ var _package_json__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../package.json */ \"(api)/./package.json\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([stripe__WEBPACK_IMPORTED_MODULE_0__]);\nstripe__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\nconst stripe = new stripe__WEBPACK_IMPORTED_MODULE_0__[\"default\"](process.env.STRIPE_API_KEY, {\n    apiVersion: \"2020-08-27\",\n    appInfo: {\n        name: \"Ignews\",\n        version: _package_json__WEBPACK_IMPORTED_MODULE_1__.version\n    }\n});\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9zcmMvc2VydmljZXMvc3RyaXBlLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUEyQjtBQUNpQjtBQUVyQyxNQUFNRSxTQUFTLElBQUlGLDhDQUFNQSxDQUFDRyxRQUFRQyxHQUFHLENBQUNDLGNBQWMsRUFBRTtJQUMzREMsWUFBWTtJQUNaQyxTQUFTO1FBQ1BDLE1BQU07UUFDTlAsT0FBT0Esb0RBQUFBO0lBQ1Q7QUFDRixHQUFFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vaWduZXdzLy4vc3JjL3NlcnZpY2VzL3N0cmlwZS50cz9hYjk5Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBTdHJpcGUgZnJvbSBcInN0cmlwZVwiXG5pbXBvcnQgeyB2ZXJzaW9uIH0gZnJvbSBcIi4uLy4uL3BhY2thZ2UuanNvblwiXG5cbmV4cG9ydCBjb25zdCBzdHJpcGUgPSBuZXcgU3RyaXBlKHByb2Nlc3MuZW52LlNUUklQRV9BUElfS0VZLCB7XG4gIGFwaVZlcnNpb246IFwiMjAyMC0wOC0yN1wiLFxuICBhcHBJbmZvOiB7XG4gICAgbmFtZTogXCJJZ25ld3NcIixcbiAgICB2ZXJzaW9uLFxuICB9LFxufSlcbiJdLCJuYW1lcyI6WyJTdHJpcGUiLCJ2ZXJzaW9uIiwic3RyaXBlIiwicHJvY2VzcyIsImVudiIsIlNUUklQRV9BUElfS0VZIiwiYXBpVmVyc2lvbiIsImFwcEluZm8iLCJuYW1lIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./src/services/stripe.ts\n");

/***/ }),

/***/ "(api)/./package.json":
/*!**********************!*\
  !*** ./package.json ***!
  \**********************/
/***/ ((module) => {

module.exports = JSON.parse('{"name":"ignews","version":"0.1.0","private":true,"scripts":{"dev":"next dev","build":"next build","start":"next start","lint":"next lint"},"dependencies":{"@stripe/stripe-js":"^2.1.9","axios":"^1.5.1","faunadb":"^4.8.0","next":"^13.5.6","next-auth":"^4.24.3","react":"18.2.0","react-dom":"18.2.0","react-icons":"^4.11.0","sass":"^1.66.1","stripe":"^13.5.0"},"devDependencies":{"@types/next-auth":"^3.15.0","@types/node":"^20.5.9","@types/react":"^18.2.21","typescript":"5.2.2"}}');

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fwebhooks&preferredRegion=&absolutePagePath=.%2Fsrc%2Fpages%2Fapi%2Fwebhooks.ts&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();